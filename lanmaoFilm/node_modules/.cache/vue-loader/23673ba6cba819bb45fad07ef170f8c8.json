{"remainingRequest":"D:\\Vue\\vuepro\\miaomiao\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Vue\\vuepro\\miaomiao\\src\\views\\Mine\\center.vue?vue&type=style&index=0&id=15ba7cc7&scoped=true&lang=css&","dependencies":[{"path":"D:\\Vue\\vuepro\\miaomiao\\src\\views\\Mine\\center.vue","mtime":1584685475031},{"path":"D:\\Vue\\vuepro\\miaomiao\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Vue\\vuepro\\miaomiao\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\Vue\\vuepro\\miaomiao\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\Vue\\vuepro\\miaomiao\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Vue\\vuepro\\miaomiao\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi51c2VySGVhZHsgd2lkdGg6MTAwcHg7IGhlaWdodDogMTAwcHg7IGJvcmRlci1yYWRpdXM6IDUwJTsgb3ZlcmZsb3c6IGhpZGRlbjt9DQoudXNlcmRpdntkaXNwbGF5OiBmbGV4O30NCi5sb2dvdXR7IG1hcmdpbi1sZWZ0OiAyMHB4OyBjb2xvcjogYmx1ZX0NCg0K"},{"version":3,"sources":["center.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4GA;AACA;AACA","file":"center.vue","sourceRoot":"src/views/Mine","sourcesContent":["<template>\r\n    <div>\r\n        <div>个人中心：</div>\r\n        <div class=\"userdiv\">当前用户：{{ $store.state.user.name }} <div class=\"logout\" @touchstart=\"handleToLogout\">退出</div></div>\r\n       <!-- <div v-if=\"$store.state.user.isAdmin\">用户身份：管理员 <a href=\"/admin\" target=\"_blank\">进入管理后台</a></div>\r\n        <div v-else>用户身份：普通会员</div> -->\r\n        <!-- <div>\r\n            <input type=\"file\" name=\"file\" value=\"上传头像\">\r\n            <img class=\"userHead\" :src=\"$store.state.user.userHead\" alt=\"\">\r\n        </div> -->\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nimport { messageBox } from '@/components/JS';\r\nexport default {\r\n    name : 'center',\r\n    methods : {\r\n        handleToLogout(){\r\n            this.axios.get('/api2/users/logout').then((res)=>{\r\n            console.log(res);\r\n                 var status = res.data.status;\r\n                if(status === 0){\r\n                    // localStorage.removeItem('name');\r\n                    // localStorage.removeItem('isAdmin');\r\n                    // this.$store.commit('user/USER_NAME', { name : '', isAdmin : false , userHead : ''});\r\n                    this.$router.push('/mine/login');\r\n                    \r\n                }\r\n            }).catch((err)=>{\r\n                console.log(err)\r\n            })\r\n        },\r\n        handleToUpload(ev){\r\n            var file = ev.target.files[0];\r\n            var param = new FormData();\r\n            param.append('file', file , file.name);\r\n            var config = {\r\n                headers : {\r\n                    'Content-Type' : 'multipart/form-data'\r\n                }\r\n            }\r\n            this.axios.post('/api2/users/uploadUserHead', param , config).then((res)=>{\r\n                var status = res.data.status;\r\n                var This = this;\r\n                if( status === 0){\r\n                    messageBox({\r\n                        title : '信息',\r\n                        content : '上传头像成功',\r\n                        ok : '确定',\r\n                        hanldeOk(){\r\n                            this.$store.commit('user/USER_NAME',{\r\n                                name : This.$store.state.user.name , \r\n                                isAdmin : This.$store.state.user.isAdmin,\r\n                                userHead : res.data.data.userHead + '?' + Math.random()\r\n                            });\r\n\r\n                        }\r\n\r\n                    })\r\n\r\n                }\r\n                else{\r\n\r\n                }\r\n            });\r\n        }    \r\n    },\r\n    beforeRouteEnter (to, from, next) {\r\n            // vm => {\r\n            //     vm.$store.commit('user/USER_NAME',{ \r\n            //                 name : 'a' , \r\n            //                 isAdmin : ture,\r\n            //                 userHead : ''\r\n            //             });\r\n            //     }\r\n\r\n            axios.get('/api2/users/getUser').then((res)=>{\r\n                var status = res.data.status;\r\n                if(status === 0){                   \r\n                    next(\r\n                        vm => {\r\n                            localStorage.setItem('name',res.data.data.username);\r\n                            localStorage.setItem('isAdmin',res.data.data.isAdmin);\r\n                            vm.$store.commit('user/USER_NAME',{ \r\n                                name : res.data.data.username , \r\n                                isAdmin : res.data.data.isAdmin,\r\n                                userHead : res.data.data.userHead\r\n                            });\r\n                        }\r\n                    );\r\n                }\r\n                else{\r\n                    next('/mine/login');\r\n                }\r\n            }).catch((err)=>{\r\n                console.log('err>',err);\r\n            \r\n            })\r\n        }\r\n\r\n   \r\n\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.userHead{ width:100px; height: 100px; border-radius: 50%; overflow: hidden;}\r\n.userdiv{display: flex;}\r\n.logout{ margin-left: 20px; color: blue}\r\n\r\n</style>\r\n"]}]}